       IDENTIFICATION DIVISION.
       PROGRAM-ID. DIAG003.
       AUTHOR. SID WAITE.
       DATE-COMPILED. TODAY.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT DIAGFILE ASSIGN TO "S30" ORGANIZATION IS INDEXED
           ACCESS IS DYNAMIC RECORD KEY IS DIAG-KEY
           ALTERNATE RECORD KEY IS DIAG-TITLE WITH DUPLICATES
           LOCK MODE MANUAL.
           SELECT FILEIN ASSIGN TO "S35"
           ORGANIZATION LINE SEQUENTIAL.
       DATA DIVISION.
       FILE SECTION.
       FD  DIAGFILE.
       01  DIAG01.
           02 DIAG-KEY PIC X(7).
           02 DIAG-TITLE PIC X(61).
           02 DIAG-MEDB PIC X(5).
       FD  FILEIN.
       01  FILEIN01 PIC X(90).
       WORKING-STORAGE SECTION.
       01  Y PIC 99 VALUE 0.
       01  ALF61.
           02 ALF1 PIC X.
           02 ALF2 PIC X(60).
       PROCEDURE DIVISION.
       P0. OPEN INPUT FILEIN I-O DIAGFILE. 
       P1.
           MOVE SPACE TO FILEIN01.
           READ FILEIN AT END GO TO P9.
           IF FILEIN01(1:4) NOT = "ADD:" GO TO P1.
           MOVE FILEIN01(16:7) TO DIAG-KEY
           READ DIAGFILE WITH LOCK
            INVALID
             DISPLAY FILEIN01
             DISPLAY "NOT ON FILE"
             ACCEPT OMITTED
             GO TO P1
           END-READ

             MOVE FILEIN01(24:60) TO ALF2
             MOVE "?" TO ALF1
             MOVE ALF61 TO DIAG-TITLE
             DISPLAY DIAG01
             REWRITE DIAG01
             DISPLAY "REWTITTEN"
             ACCEPT OMITTED
             GO TO P1.

       P9. CLOSE DIAGFILE FILEIN. 
           STOP RUN.
